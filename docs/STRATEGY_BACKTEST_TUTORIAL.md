# 量化策略回测功能使用教程

## 📚 功能概述

量化策略回测平台是一个强大的工具，允许您：

1. **浏览策略库** - 查看所有可用的量化交易策略
2. **运行回测** - 在历史数据上测试策略表现
3. **分析结果** - 查看详细的回测报告和性能指标
4. **优化参数** - 调整策略参数以找到最佳配置

## 🎯 这个功能做了什么？

### 1. 策略列表展示
- 显示所有可用的交易策略
- 每个策略包含：
  - 策略名称和描述
  - 策略类型（趋势跟踪、均值回归、动量等）
  - 策略类别（技术分析、基本面分析、量化策略）
  - 最佳历史表现指标（夏普比率、收益率等）

### 2. 策略筛选
- 按策略类型筛选（趋势跟踪、均值回归、动量等）
- 按策略类别筛选（技术分析、基本面分析、量化策略）

### 3. 回测功能
- 选择股票代码（如 AAPL, TSLA, NVDA）
- 设置回测时间范围（开始日期和结束日期）
- 设置初始资金
- 调整策略参数
- 运行回测并查看结果

### 4. 回测结果分析
回测结果包含以下关键指标：

#### 核心指标
- **总收益率** - 整个回测期间的总收益百分比
- **年化收益率** - 年化后的收益率
- **夏普比率** - 风险调整后的收益指标（越高越好）
- **最大回撤** - 从峰值到谷底的最大跌幅（越小越好）
- **胜率** - 盈利交易占总交易的比例

#### 交易统计
- 总交易次数
- 盈利交易数
- 亏损交易数
- 平均盈利金额
- 平均亏损金额
- 盈亏比（Profit Factor）

#### 可视化
- **收益曲线图** - 展示策略在整个回测期间的资产变化曲线

## 🚀 如何使用

### 步骤 1: 访问策略页面

1. 登录系统后，在侧边栏点击 **"策略回测"** 或直接访问 `/strategies`
2. 您将看到所有可用的策略列表

### 步骤 2: 筛选策略

1. 使用页面顶部的筛选器：
   - **策略类型**：选择您感兴趣的策略类型
   - **策略类别**：选择技术分析、基本面分析或量化策略
2. 点击 **"筛选"** 按钮

### 步骤 3: 运行回测

1. 在策略卡片上点击 **"运行回测"** 按钮
2. 在弹出的对话框中填写：
   - **股票代码**：例如 `AAPL`, `TSLA`, `NVDA`
   - **开始日期**：回测开始日期
   - **结束日期**：回测结束日期
   - **初始资金**：默认 100,000 美元
   - **策略参数**：根据策略类型调整参数（可选）

3. 点击 **"开始回测"** 按钮

### 步骤 4: 查看结果

回测完成后，系统会自动显示结果页面，包含：

1. **关键指标卡片** - 总收益率、夏普比率、最大回撤、胜率
2. **收益曲线图** - 可视化展示策略表现
3. **详细统计** - 交易统计和其他指标

## 📊 可用策略说明

### 1. 双均线策略 (Moving Average Crossover)
- **类型**：趋势跟踪
- **原理**：当短期均线上穿长期均线时买入，下穿时卖出
- **参数**：
  - `short_window`: 短期均线周期（默认：20）
  - `long_window`: 长期均线周期（默认：50）
- **适用场景**：趋势明显的市场

### 2. RSI 超买超卖策略
- **类型**：均值回归
- **原理**：当RSI低于30时买入（超卖），高于70时卖出（超买）
- **参数**：
  - `rsi_period`: RSI计算周期（默认：14）
  - `oversold`: 超卖阈值（默认：30）
  - `overbought`: 超买阈值（默认：70）
- **适用场景**：震荡市场

### 3. MACD 金叉死叉策略
- **类型**：趋势跟踪
- **原理**：MACD线上穿信号线时买入，下穿时卖出
- **参数**：
  - `fast_period`: 快速EMA周期（默认：12）
  - `slow_period`: 慢速EMA周期（默认：26）
  - `signal_period`: 信号线周期（默认：9）
- **适用场景**：捕捉趋势变化

### 4. 布林带突破策略
- **类型**：突破策略
- **原理**：价格突破上轨时买入，跌破下轨时卖出
- **参数**：
  - `period`: 移动平均周期（默认：20）
  - `std_dev`: 标准差倍数（默认：2）
- **适用场景**：波动率较高的市场

### 5. 动量策略 (Momentum)
- **类型**：动量策略
- **原理**：基于价格动量，买入近期表现强势的股票
- **参数**：
  - `lookback_period`: 回看周期（默认：20）
  - `momentum_threshold`: 动量阈值（默认：0.05）
- **适用场景**：趋势延续的市场

### 6. 均值回归策略
- **类型**：均值回归
- **原理**：当价格偏离移动平均线一定幅度时，预期回归均值
- **参数**：
  - `ma_period`: 移动平均周期（默认：20）
  - `deviation_threshold`: 偏离阈值（默认：0.02）
- **适用场景**：震荡市场

### 7. 价值投资策略
- **类型**：价值投资
- **原理**：基于PE、PB等估值指标，买入低估值的股票
- **参数**：
  - `max_pe`: 最大市盈率（默认：15）
  - `max_pb`: 最大市净率（默认：2）
- **适用场景**：长期投资

### 8. 成长股策略
- **类型**：成长股
- **原理**：基于营收和利润增长率，选择高成长性股票
- **参数**：
  - `min_revenue_growth`: 最小营收增长率（默认：0.2）
  - `min_earnings_growth`: 最小利润增长率（默认：0.15）
- **适用场景**：成长型投资

## 💡 使用技巧

### 1. 选择合适的策略
- **趋势市场**：使用趋势跟踪策略（双均线、MACD）
- **震荡市场**：使用均值回归策略（RSI、均值回归）
- **高波动市场**：使用突破策略（布林带）

### 2. 优化参数
- 从默认参数开始
- 逐步调整参数，观察对结果的影响
- 记录最佳参数组合

### 3. 回测时间范围
- 建议至少回测 1 年以上的数据
- 包含不同的市场环境（牛市、熊市、震荡市）
- 避免过度拟合（overfitting）

### 4. 理解指标
- **夏普比率 > 1**：策略表现良好
- **夏普比率 > 2**：策略表现优秀
- **最大回撤 < 20%**：风险控制较好
- **胜率 > 50%**：策略有盈利潜力

## ⚠️ 注意事项

1. **历史表现不代表未来**：回测结果基于历史数据，实际交易结果可能不同
2. **市场环境变化**：策略在不同市场环境下表现可能差异很大
3. **交易成本**：回测中已考虑交易佣金（0.1%），但实际成本可能更高
4. **滑点影响**：实际交易可能存在滑点，影响收益
5. **数据质量**：确保使用高质量的历史数据

## 🔧 技术实现

### 后端架构
- **数据库模型**：`Strategy` 和 `BacktestResult` 表
- **回测引擎**：`backtest_engine.py` 实现各种策略逻辑
- **API端点**：RESTful API 提供策略列表、回测运行、结果查询

### 前端实现
- **策略列表**：响应式卡片布局
- **回测表单**：动态参数输入
- **结果可视化**：使用 Chart.js 绘制收益曲线

### 数据来源
- 使用 `yfinance` 库获取历史股价数据
- 自动计算技术指标（MA、RSI、MACD、布林带等）

## 📈 示例场景

### 场景 1: 测试双均线策略在 AAPL 上的表现

1. 选择 "双均线策略"
2. 设置参数：
   - 股票代码：`AAPL`
   - 开始日期：`2023-01-01`
   - 结束日期：`2024-01-01`
   - 初始资金：`100000`
   - 短期均线：`20`
   - 长期均线：`50`
3. 运行回测
4. 查看结果：总收益率、夏普比率、最大回撤等

### 场景 2: 优化 RSI 策略参数

1. 选择 "RSI 超买超卖策略"
2. 第一次回测使用默认参数（RSI=14, 超卖=30, 超买=70）
3. 记录结果
4. 调整参数（例如：超卖=25, 超买=75）
5. 再次回测并对比结果
6. 选择表现更好的参数组合

## 🎓 学习资源

- **技术分析基础**：了解移动平均线、RSI、MACD 等指标
- **量化交易**：学习策略开发、回测、风险管理
- **Python 量化**：掌握 pandas、numpy 等数据分析库

## 📞 支持

如有问题或建议，请：
1. 查看系统日志
2. 检查 API 响应
3. 联系技术支持

---

**祝您交易顺利！** 📊🚀
